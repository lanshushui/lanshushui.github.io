---
title: 网络加载点9图的补充
categories:
  - 疑难杂症
tags:
  - 点9图
abbrlink: eb603a17
---






 参考文档：

[对嘛！这才是从网络加载点9图的正确姿势](https://juejin.cn/post/7147458316103811108)

去看上面的文档了解，这个博客文只是些个人记录

目前方案是调用 AAPT 预处理完后再上传后台

## 开始

### 1.制作点9图

傻瓜式教程

[Android studio中.9图片的含义及制作教程](https://blog.csdn.net/sunbinkang/article/details/77331718)

### 2.AAPT命令

``` 
C:\Users\AppData\Local\Android\Sdk\build-tools\31.0.0\aapt.exe c -v -S  . -C .\9out
```

将该命令打包成cmd文件，与要处理的点9图处于同一个目录，运行即可（将aapt目录改为自己的对应目录）

上面命令调用AAPT处理资源，将有黑边的点9图转换为正常PNG



### 2.获得点9图对应的Bitmap

参考文档方案测试不行，因此我的处理是不让Glide生成Bitmap，只是下载文件，然后BitmapFactory转为Bitmap

``` kotlin
Glide.with(view)
.asFile()
.load(url)
.into(object :
      SimpleTarget<File>() {
          override fun onResourceReady(resource: File, p1: Transition<in File>?) {
              val bitmap = BitmapFactory.decodeFile(resource.absolutePath)
              val chunk = bitmap.ninePatchChunk
              val drawable = if (NinePatch.isNinePatchChunk(chunk)) {
                  NinePatchDrawable(context.resources, bitmap, chunk, Rect(), null)
              } else {
                  BitmapDrawable(context.resources, bitmap)
              }
              bgView.setImageDrawable(drawable)
          }
      })
```



<font color='red'>感觉好像都搞定了。。。。。  但还剩下个Bitmap的密度问题</font>

### 3.获得正确密度尺寸的Bitmap

BitmapFactory.decodeFile(String pathName)  方法的调用不会根据手机尺寸进行图片的缩放

[屏幕密度掺入BitmapFactory里decodeFile与decodeResource的差异](https://blog.csdn.net/sevensundark/article/details/7616450)

这样子会导致一个问题

假如我们有个气泡右上角有个50x50 px的皇冠小icon，我们想要的效果.9图的效果肯定是 

1. 在一倍密度的手机下皇冠大小是50x50 px，剩下的气泡部分由可拉伸的区域填补
2. 在二倍密度的手机下皇冠大小是100x100 px，剩下的气泡部分由可拉伸的区域填补
3. 在三倍密度的手机下皇冠大小是150x150 px，剩下的气泡部分由可拉伸的区域填补



直接调用BitmapFactory.decodeFile(String pathName)  会导致在任何尺寸的手机上气泡皇冠的大小都是50 X 50 px。所以我们要根据手机的尺寸进行图片的缩放

修改第二步代码为：

```kotlin
Glide.with(view)
.asFile()
.load(url)
.into(object :
      SimpleTarget<File>() {
          override fun onResourceReady(resource: File, p1: Transition<in File>?) {
              opt.inDensity = 320 //这是因为我的原始图片是个二倍图 160*2
              opt.inTargetDensity = BasicConfig.appContext.resources.displayMetrics.densityDpi
              val bitmap = BitmapFactory.decodeFile(resource.absolutePath, opt)
              val chunk = bitmap.ninePatchChunk
              val drawable = if (NinePatch.isNinePatchChunk(chunk)) {
                  NinePatchDrawable(context.resources, bitmap, chunk, Rect(), null)
              } else {
                  BitmapDrawable(context.resources, bitmap)
              }
              bgView.setImageDrawable(drawable)
          }
```



  opt.inDensity = 160*你的图片是几倍图  。我的情况是设计提供的是二倍图，所以设置为320



Keep Moving Forward
